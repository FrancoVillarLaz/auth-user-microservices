########################################
# Servidor
########################################
quarkus.http.host=0.0.0.0
quarkus.http.port=${SERVER_PORT:8080}
quarkus.http.root-path=/api/auth-service

########################################
# Database
########################################
quarkus.datasource.db-kind=mysql
quarkus.datasource.username=${SPRING_DATASOURCE_USERNAME:inncome}
quarkus.datasource.password=${SPRING_DATASOURCE_PASSWORD:Inncomelocal123@@}
quarkus.datasource.jdbc.url=${SPRING_DATASOURCE_URL:jdbc:mysql://mysql:3306/inncome-local?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC}
quarkus.datasource.jdbc.driver=com.mysql.cj.jdbc.Driver
quarkus.hibernate-orm.database.generation=${SPRING_JPA_HIBERNATE_DDL_AUTO:update}
quarkus.datasource.jdbc.max-size=16
quarkus.datasource.jdbc.min-size=2

########################################
# Redis
########################################
quarkus.redis.hosts=redis://${REDIS_HOST:redis}:${REDIS_PORT:6379}
quarkus.redis.password=${REDIS_PASSWORD:inncomelocalredis}

########################################
# Kafka
########################################
mp.messaging.connector.smallrye-kafka.bootstrap.servers=${SPRING_KAFKA_BOOTSTRAP_SERVERS:kafka:9092}
mp.messaging.connector.smallrye-kafka.client.id=auth-service-client
mp.messaging.connector.smallrye-kafka.ssl.endpoint.identification.algorithm=
mp.messaging.connector.smallrye-kafka.security.protocol=PLAINTEXT
mp.messaging.connector.smallrye-kafka.listener.name=PLAINTEXT

# Auth events (outgoing)
mp.messaging.outgoing.auth-events.connector=smallrye-kafka
mp.messaging.outgoing.auth-events.topic=auth.events
mp.messaging.outgoing.auth-events.value.serializer=org.apache.kafka.common.serialization.StringSerializer
mp.messaging.outgoing.auth-events.key.serializer=org.apache.kafka.common.serialization.StringSerializer

# User events (incoming)
mp.messaging.incoming.user-events.connector=smallrye-kafka
mp.messaging.incoming.user-events.topic=user-events
mp.messaging.incoming.user-events.value.deserializer=org.apache.kafka.common.serialization.StringDeserializer
mp.messaging.incoming.user-events.key.deserializer=org.apache.kafka.common.serialization.StringDeserializer
mp.messaging.incoming.user-events.auto.offset.reset=earliest
mp.messaging.incoming.user-events.enable.auto.commit=true

########################################
# JWT - RS256
########################################
# Propiedades para la GENERACIÓN/FIRMA
smallrye.jwt.sign.key.location=classpath:META-INF/keys/privateKey.pem
smallrye.jwt.sign.key-format=PEM
smallrye.jwt.sign.algorithm=RS256

# Propiedades de VERIFICACIÓN
mp.jwt.verify.publickey.location=classpath:META-INF/keys/publicKey.pem
mp.jwt.verify.issuer=auth-service

# Claim mapping
smallrye.jwt.path.groups=role

# Expiración (valores actualizados para compatibilidad)
jwt.access.token.expiration=${JWT_EXPIRATION:86400000}
jwt.refresh.token.expiration=${JWT_REFRESH_EXPIRATION:604800000}

# Subject claim
quarkus.smallrye-jwt.subject.claim=userId
smallrye.jwt.claims.sub-path=userId
smallrye.jwt.require.named-principal=false

# Issuer
smallrye.jwt.verify.issuer=auth-service

########################################
# Logging
########################################
quarkus.log.category."io.smallrye.jwt".level=DEBUG
quarkus.log.category."io.quarkus.smallrye.jwt".level=DEBUG
quarkus.log.console.level=INFO
quarkus.log.level=DEBUG
quarkus.log.category."io.quarkus.security".level=DEBUG
quarkus.smallrye-jwt.show-message-details=true

########################################
# Dev Services (desactivado para Docker)
########################################
quarkus.devservices.enabled=true

########################################
# CORS
########################################
quarkus.http.cors=true
quarkus.http.cors.origins=${CORS_ALLOWED_ORIGIN:*}
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors.exposed-headers=location,authorization
quarkus.http.cors.access-control-allow-credentials=true

########################################
# GraalVM Native Configuration
########################################
quarkus.native.additional-build-args=--verbose,\
--no-fallback,\
-H:+ReportExceptionStackTraces,\
-H:Name=auth-service-1.0.0-runner
quarkus.native.enable-https-url-handler=true
quarkus.native.resources.includes=META-INF/keys/publicKey.pem,META-INF/keys/privateKey.pem